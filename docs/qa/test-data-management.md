# テストデータ管理

## 方針

テストの再現性と独立性を担保するため、テストデータの作成・管理を標準化する。

## ファクトリパターン

### 基本設計

- テストデータの作成にはファクトリ関数を使う
- ハードコードされたテストデータをテストコード内に直接書かない
- ファクトリはデフォルト値を持ち、必要な部分だけオーバーライドできる

<!-- 以下は TypeScript の例。プロジェクトの言語に合わせて /init-project 時に書き換えること -->

```typescript
// 例
function createUser(overrides = {}) {
  return {
    id: generateId(),
    name: "テストユーザー",
    email: `test-${generateId()}@example.com`,
    role: "member",
    ...overrides,
  };
}
```

### ファクトリの配置

- ユニット/統合テスト用: `tests/factories/`
- E2Eテスト用: `e2e/fixtures/`

## シードデータ

### 開発環境

- `scripts/seed.ts`（または同等のスクリプト）でシードデータを投入
- シードデータは最小限にする（動作確認に必要な分のみ）
- シードスクリプトは冪等性を持たせる（何度実行しても同じ結果）

### テスト環境

- テストごとにクリーンな状態から開始する
- シードデータに依存するテストは書かない
- DBの初期化タイミング:
  - ユニットテスト: テストごとにモックをリセット
  - 統合テスト: テストスイートの前にDB初期化
  - E2E: テストスイートの前にDB初期化 + テスト間でのクリーンアップ

## 本番データの扱い

- テスト環境に本番データを使用しない（原則）
- やむを得ず使用する場合:
  - 個人情報は必ずマスキングする
  - マスキングルール: メールは `***@example.com`、名前は `ユーザーXXX` に置換
  - マスキングスクリプトを用意し、手動マスキングは禁止
  - マスキング済みデータにもアクセス制限を設ける
