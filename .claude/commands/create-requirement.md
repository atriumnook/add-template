# 要件定義の作成

新しい機能の要件定義ドキュメントを作成する。

## 前提確認

1. docs/project.md を読み、プロダクトのビジョン・対象ユーザー・事業制約を把握する
2. チケットIDを確認する（未定の場合は日付ベースで命名）
3. 関連する既存の要件・仕様がないか確認する
   - `docs/requirements/` を検索
   - `docs/specs/{{domain-name}}/` の該当ドメインを確認

## 実行手順

1. **ファイルを作成する**
   - 配置先: `docs/requirements/{{TICKET_ID}}-{{feature-name}}.md`
   - ドメインサブディレクトリが存在する場合はその配下に配置
   - テンプレート: `docs/requirements/_TEMPLATE.md` を使用

2. **フロントマターを記入する**
   - テンプレートのフロントマターコメントに従って各フィールドを記入する
   - status は `draft` で作成する

3. **scope を判定する**
   - 以下の基準で scope を判定し、ユーザーに提案する:
     - **lite を推奨**: 単一ドメイン + 既存 specs の軽微な変更 + セキュリティ影響なし
     - **full を推奨**: 複数ドメイン / API 変更 / セキュリティ影響 / 新規ドメイン
   - ユーザーが判定を上書きできる
   - **lite の場合**: 背景と目的、受け入れ基準、スコープ外のみ記入する。ユーザーストーリー・ビジネスルール・技術判断・暗黙の前提は省略可
   - **full の場合**: 全セクションを記入する（従来通り）

4. **各セクションを記入する**
   - 背景と目的: なぜこの機能が必要か
   - ユーザーストーリー: 誰が何をしたいか
   - ビジネスルール: 守るべき制約・条件（BR-N 形式で番号付与）
   - 技術判断: この要件固有の技術的な決定事項と理由
   - 受け入れ基準: 正常系・異常系・非機能要件（該当する場合）のチェックリスト
   - スコープ外: この要件では対応しない事項（将来対応の可能性があるものも含む）

5. **仕様変更の場合は 変更区分セクションを使う**
   - 既存機能の変更の場合、ADDED / MODIFIED / REMOVED で変更区分を明示
   - 変更理由を必ず記載

6. **受け入れ基準を具体的に書く**
   - 正常系と異常系の両方を含める
   - セキュリティ関連の機能（認証、ユーザーデータ操作、外部入力処理等）の場合、セキュリティ観点の異常系も含める
   - 非機能要件がある場合は記入する（レスポンスタイム、スループット、認証要件等）
   - テスト可能な形で記述（曖昧な表現を避ける）

## 完了条件

- [ ] ファイルが正しいパスに作成されている
- [ ] 全セクションが記入されている（該当なしの場合はその旨を記載）
- [ ] 受け入れ基準が具体的で、テスト可能な形になっている
- [ ] 関連する既存の要件・仕様との整合性を確認済み
- [ ] 新しい用語が出現した場合、docs/project.md の用語集に追加されている
- [ ] status は `draft` で作成されている（`approved` への変更はチームのレビュー後に行う）

## 関連スキル

- **requirements-writing**: 良いユーザーストーリー・受け入れ基準・ビジネスルールの書き方
- **doc-placement**: ファイル配置先・命名規約の判断基準

## 注意

- 要件は約300行を目安にする。超える場合はユーザーストーリー単位で別ファイルに分割する
- 技術的な実装詳細は書かない（それは specs の役割）
- 横断的な技術判断は /create-adr を使う
- 要件作成後、必要に応じて /create-spec で仕様書を作成する
