# PR レビュープロセス

プルリクエストの品質を確認する。PR 作成前のセルフレビュー、または他者の PR レビューの両方に使用する。

## PR の作成（未作成の場合）

1. `git status` で全変更がコミット済みか確認する
2. `git push -u origin {{branch-name}}`
3. PR を作成する（git-workflow.md の「PR説明文の構成」に従う）

## 前提確認

1. PR に以下が全て含まれているか確認する
   - docs/requirements/ の要件（新規 or 更新）
   - docs/specs/ の仕様（新規 or 更新）
   - src/ のコード変更
   - テスト（tests/、e2e/、またはソースと同階層のコロケーション方式）
2. CI が通っていることを確認する

### docs/ ブランチの場合

コード変更を伴わないドキュメント単体の PR（docs/ ブランチ）の場合:
- src/ やテストの変更は不要
- レビュー手順の「1. 要件・仕様の確認」と「4. ドキュメントの整合性」のみ実施する

## レビュー手順

### 1. 要件・仕様の確認

- requirements の要件は明確か、受け入れ基準はテスト可能か
- specs が requirements の内容を正しく反映しているか
- 仕様変更がある場合、変更区分セクション（ADDED / MODIFIED / REMOVED）が適切か
- 既存の仕様との整合性は取れているか

### 2. コードの確認

consistency-check スキルの Layer 2（specs → code）に従って確認する:

- specs の仕様通りに実装されているか（エンドポイント・リクエスト・レスポンス）
- 不変条件がコードで強制されているか
- アーキテクチャ方針・コーディング規約に準拠しているか
- セキュリティ上の懸念はないか

### 3. テストの確認

- 受け入れ基準がテストでカバーされているか
- 正常系・異常系の両方がテストされているか
- docs/qa/test-strategy.md の方針に沿っているか
- テストが独立しており、実行順序に依存しないか

### 4. ドキュメントの整合性

- requirements → specs → コード → テスト の一貫性
- 新しい用語が追加された場合、docs/project.md の用語集に反映されているか
- 技術判断がある場合、ADR として記録されているか
- Approve の場合、対象 requirements の status を `implemented` に変更する
- 対象 requirements の内容が specs に正しく集約されていることを確認する

## 関連スキル

- **consistency-check**（手順 1〜4 全体）: 一貫性検証の Layer 1〜4 チェック、問題の重大度判定、レビューコメントの書き方
- **requirements-writing**（手順 1）: 要件の品質判断基準（レビュー観点として参照）
- **test-approach**（手順 3）: テストの粒度・カバレッジの妥当性判断

## 完了条件

- [ ] 上記4カテゴリの全項目を確認済み
- [ ] 新しい用語がある場合、docs/project.md の用語集に追加されていることを確認済み
- [ ] 問題がある場合はコメントで具体的な修正案を提示済み
- [ ] Approve / Request Changes の判定を実施済み
- [ ] Approve した場合、対象 requirements の status が `implemented` に更新されている
- [ ] docs/state.md のセッション履歴が更新されている
