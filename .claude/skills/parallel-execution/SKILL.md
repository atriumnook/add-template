---
name: parallel-execution
description: 独立タスクの並列実行判断基準。/implement で複数タスクを効率的に実行したいとき、/review で4層チェックを並列化したいときに使用する。
commands: ["/implement", "/review"]
---

# 並列実行ガイドライン

## 並列実行の判断基準

以下の **すべて** を満たすタスクは並列実行できる:

- ファイルの編集範囲が重複しない
- 一方の出力が他方の入力にならない
- 共有リソース（DB マイグレーション等）への書き込みが競合しない

1つでも該当しない場合は順次実行する。迷ったら順次実行を選ぶ。

## 並列実行パターン

### パターン1: 独立タスクの並列実行

**使用場面**: /implement 内で独立した複数のエンドポイント・コンポーネント・モジュールを実装するとき

- 各タスクを Task ツールの subagent として同時起動する
- 各 subagent には対象ファイルのパスと specs の該当セクションを明示的に渡す
- 同一ファイルへの編集が発生しないことを事前に確認する
- 完了後に結果を集約し、統合テストを実行する

### パターン2: 調査→実行の直列化

**使用場面**: /create-requirement の前段階で、複数ドメインの既存実装を調査するとき

- 調査タスク（コードベース探索、既存 specs 確認、依存関係分析）を並列実行する
- 調査結果を集約してから、requirements の作成に入る
- 調査結果は state.md の「調査メモ」セクションに記録する

### パターン3: レビュー並列化

**使用場面**: /review で4層の一貫性チェックを実行するとき

- Layer 1（requirements→specs）と Layer 2（specs→code）は独立して検証可能
- Layer 3（code→test）は Layer 2 の結果に依存するため、Layer 2 の後に実行する
- Layer 4（横断的整合性）は他のレイヤーと独立して実行可能
- 推奨: Layer 1 + Layer 2 + Layer 4 を並列 → Layer 3 を後続実行

## 並列実行してはいけない場面

以下は **必ず順次実行** する:

- specs の作成と、その specs に基づくコード実装
- requirements の変更と、変更後の specs 更新
- DB マイグレーションの実行と、マイグレーション後のテスト
- 同一ファイルへの編集が発生する複数タスク
- state.md の更新（常に最新のセッションから1つずつ更新する）

## worktree 分離の判断

Task ツールの `isolation: "worktree"` を使用すべき場面:

- 大きな実装タスクで、失敗時にロールバックしたい場合
- 実験的な実装を本体と分離して試したい場合

通常の並列タスク（ファイル競合がない場合）では worktree 分離は不要。
